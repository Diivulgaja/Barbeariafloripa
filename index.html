<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ricardo Barbershop | O Seu Momento</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        amber: { 450: '#F59E0B', 550: '#D97706' },
                        zinc: { 850: '#1f1f22', 925: '#121214' }
                    },
                    fontFamily: {
                        'display': ['Playfair Display', 'serif'],
                        'body': ['Outfit', 'sans-serif'],
                    },
                    screens: { 'xs': '375px' }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Supabase JS (Global Build) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;0,800;1,400&display=swap" rel="stylesheet">

    <style>
        .bg-noise {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        body { font-family: 'Outfit', sans-serif; background-color: #0c0c0e; color: #e4e4e7; }
        .glass-panel { background: rgba(20, 20, 22, 0.95); backdrop-filter: blur(16px); border-bottom: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-card { background: rgba(30, 30, 33, 0.4); border: 1px solid rgba(255, 255, 255, 0.03); transition: all 0.3s ease; }
        .glass-card:hover { background: rgba(40, 40, 44, 0.6); border-color: rgba(217, 119, 6, 0.3); transform: translateY(-2px); }
        .glass-card.selected { background: rgba(217, 119, 6, 0.08); border-color: #d97706; }
        .glass-input { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); color: white; transition: all 0.3s ease; }
        .glass-input:focus { background: rgba(0, 0, 0, 0.5); border-color: #d97706; outline: none; }
        .btn-primary { background-color: #d97706; color: white; transition: all 0.3s ease; box-shadow: 0 4px 20px -8px rgba(217, 119, 6, 0.5); }
        .btn-primary:hover { background-color: #b45309; transform: translateY(-1px); }
        .photo-cinematic { filter: sepia(20%) contrast(1.1) brightness(0.9); transition: filter 0.5s ease; }
        .photo-cinematic:hover { filter: sepia(0%) contrast(1) brightness(1); }
        .loader { border: 2px solid rgba(255,255,255,0.1); border-radius: 50%; border-top: 2px solid #d97706; width: 24px; height: 24px; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fade-in-up 0.5s ease-out forwards; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0c0c0e; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d97706; }
    </style>
</head>
<body class="antialiased selection:bg-amber-800 selection:text-white relative">

    <div class="bg-noise"></div>

    <!-- NAVIGATION -->
    <nav class="fixed w-full z-50 glass-panel border-b-0">
        <div class="container mx-auto px-6 py-5 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i data-lucide="scissors" class="w-6 h-6 text-amber-500"></i>
                <div>
                    <h1 class="text-lg font-bold leading-none tracking-tight text-white font-display">RICARDO</h1>
                    <span class="text-[0.6rem] text-zinc-500 tracking-[0.2em] font-medium uppercase font-body">Barbershop</span>
                </div>
            </div>

            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center gap-10">
                <a href="#home" class="text-zinc-400 hover:text-white transition-colors text-sm font-medium tracking-wide">Início</a>
                <a href="#services" class="text-zinc-400 hover:text-white transition-colors text-sm font-medium tracking-wide">Serviços</a>
                <a href="#about" class="text-zinc-400 hover:text-white transition-colors text-sm font-medium tracking-wide">A Casa</a>
                
                <!-- Guest -->
                <div id="nav-guest" class="flex items-center gap-6">
                    <button onclick="openAuthModal('login')" class="text-zinc-300 hover:text-amber-500 transition-colors text-sm font-medium tracking-wide">Entrar na conta</button>
                    <button onclick="startBooking()" class="btn-primary font-bold py-2.5 px-6 rounded-lg text-sm">Agendar</button>
                </div>

                <!-- Logged In -->
                <div id="nav-user" class="hidden items-center gap-4 relative">
                    <div onclick="toggleProfileDropdown()" class="flex items-center gap-3 cursor-pointer select-none group">
                        <div class="text-right hidden lg:block">
                            <p class="text-[10px] text-zinc-500 uppercase tracking-wider font-bold">Fala,</p>
                            <p id="user-name-display" class="text-sm font-bold text-zinc-200 group-hover:text-amber-500 transition-colors font-display">Usuário</p>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-zinc-800 border border-zinc-700 overflow-hidden flex items-center justify-center">
                            <span id="user-initial" class="font-bold text-amber-500 font-display">U</span>
                        </div>
                    </div>
                    <!-- Dropdown -->
                    <div id="profile-dropdown" class="absolute top-full right-0 mt-4 w-56 bg-[#18181b] border border-white/5 rounded-xl shadow-2xl py-2 hidden z-50">
                        <button onclick="openAppointments()" class="w-full text-left px-4 py-3 text-sm text-zinc-300 hover:bg-white/5 flex items-center gap-3"><i data-lucide="calendar" class="w-4 h-4 text-amber-500"></i> Meus Horários</button>
                        <div class="h-px bg-white/5 my-1 mx-4"></div>
                        <button onclick="logout()" class="w-full text-left px-4 py-3 text-sm text-zinc-400 hover:bg-white/5 flex items-center gap-3"><i data-lucide="log-out" class="w-4 h-4"></i> Sair da conta</button>
                    </div>
                    <button onclick="startBooking()" class="bg-zinc-800 hover:bg-zinc-700 text-white font-medium py-2.5 px-5 rounded-lg border border-white/5 text-sm ml-2">Novo Corte</button>
                </div>
            </div>

            <!-- Mobile Menu Button -->
            <button class="md:hidden text-zinc-400 hover:text-white p-2" onclick="toggleMobileMenu()"><i data-lucide="menu" id="menu-icon" class="w-6 h-6"></i></button>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden glass-panel border-t border-white/5 p-6 animate-fade-in-up absolute top-full left-0 w-full bg-[#0c0c0e] h-screen z-40">
            <div class="flex flex-col gap-6 pt-4">
                <a href="#home" class="text-xl font-display text-zinc-200" onclick="toggleMobileMenu()">Início</a>
                <a href="#services" class="text-xl font-display text-zinc-200" onclick="toggleMobileMenu()">Serviços</a>
                <a href="#about" class="text-xl font-display text-zinc-200" onclick="toggleMobileMenu()">A Casa</a>
                <div class="h-px bg-white/10 my-2"></div>
                <div id="mobile-guest" class="flex flex-col gap-4">
                     <button onclick="toggleMobileMenu(); openAuthModal('login')" class="text-lg font-medium text-zinc-400 text-left flex items-center gap-2"><i data-lucide="log-in" class="w-5 h-5"></i> Fazer Login</button>
                    <button onclick="toggleMobileMenu(); startBooking()" class="w-full bg-amber-600 text-white font-bold py-4 px-6 rounded-xl mt-2 text-center shadow-lg">Agendar Agora</button>
                </div>
                <div id="mobile-user" class="hidden flex-col gap-4">
                    <p class="text-zinc-500 text-sm">Logado como <strong id="mobile-user-name" class="text-white">Usuário</strong></p>
                    <button onclick="toggleMobileMenu(); openAppointments()" class="text-lg font-medium text-zinc-200 text-left flex items-center gap-3"><i data-lucide="calendar-check" class="w-5 h-5 text-amber-500"></i> Meus Horários</button>
                    <button onclick="toggleMobileMenu(); logout()" class="text-lg font-medium text-red-400 text-left flex items-center gap-3"><i data-lucide="log-out" class="w-5 h-5"></i> Sair</button>
                    <button onclick="toggleMobileMenu(); startBooking()" class="w-full bg-amber-600 text-white font-bold py-4 px-6 rounded-xl mt-4 shadow-lg">Novo Agendamento</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <section id="home" class="relative h-screen flex items-center overflow-hidden">
        <div class="absolute inset-0 z-0">
            <img src="https://images.unsplash.com/photo-1593702295094-aea8c59b29fe?auto=format&fit=crop&q=80&w=2070" alt="Barbershop" class="w-full h-full object-cover opacity-50 photo-cinematic"/>
            <div class="absolute inset-0 bg-gradient-to-r from-[#0c0c0e] via-[#0c0c0e]/90 to-transparent"></div>
        </div>
        <div class="container mx-auto px-6 relative z-10 pt-20">
            <div class="max-w-2xl animate-fade-in-up">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-md border border-amber-500/20 bg-amber-500/5 mb-8"><span class="w-1.5 h-1.5 rounded-full bg-amber-500"></span><span class="text-xs font-bold text-amber-500 tracking-wider uppercase">Estilo & Tradição</span></div>
                <h1 class="text-5xl sm:text-6xl md:text-7xl font-bold text-white leading-[1.1] mb-8 font-display">Não é só cabelo.<br/><span class="italic text-zinc-400">É sobre como você se sente.</span></h1>
                <p class="text-zinc-400 text-lg md:text-xl mb-10 leading-relaxed font-light border-l-2 border-white/10 pl-6">Aquele momento da semana pra relaxar, tomar uma gelada e sair com o visual na régua.</p>
                <div class="flex flex-col sm:flex-row gap-5">
                    <button onclick="startBooking()" class="btn-primary text-white font-bold py-4 px-10 rounded-lg text-sm uppercase tracking-wide flex items-center justify-center gap-3">Bora agendar? <i data-lucide="arrow-right" class="w-4 h-4"></i></button>
                    <button onclick="document.getElementById('services').scrollIntoView()" class="text-zinc-300 hover:text-white font-medium py-4 px-8 rounded-lg border border-white/10 hover:bg-white/5 transition-all text-sm uppercase tracking-wide">Ver Preços</button>
                </div>
            </div>
        </div>
    </section>

    <!-- SERVICES -->
    <section id="services" class="py-24 relative">
        <div class="container mx-auto px-6 relative">
            <div class="flex flex-col md:flex-row justify-between items-end mb-16 gap-6 border-b border-white/5 pb-8">
                <div><h2 class="text-4xl font-bold text-white font-display mb-2">O que a gente domina</h2><p class="text-zinc-500 text-sm">Serviços pensados para o homem moderno.</p></div>
            </div>
            <div id="services-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="py-24 bg-zinc-900/20 border-y border-white/5">
        <div class="container mx-auto px-6">
            <div class="flex flex-col lg:flex-row items-center gap-16">
                <div class="lg:w-1/2 relative w-full"><div class="relative rounded-lg overflow-hidden"><div class="absolute inset-0 bg-amber-500/10 mix-blend-overlay"></div><img src="https://images.unsplash.com/photo-1503951914875-452162b7f30a?auto=format&fit=crop&q=80&w=1000" alt="Ricardo" class="w-full grayscale hover:grayscale-0 transition-all duration-700 object-cover aspect-[4/5]"/></div></div>
                <div class="lg:w-1/2">
                    <h3 class="text-amber-500 font-bold uppercase tracking-[0.2em] text-xs mb-4">Nossa Resenha</h3>
                    <h2 class="text-4xl md:text-5xl font-bold text-white mb-8 font-display">Muito prazer, <br/>sou o Ricardo.</h2>
                    <div class="space-y-6 text-zinc-400 text-lg leading-relaxed font-light"><p>Comecei cortando cabelo na varanda de casa. A ideia nunca foi ser uma "fábrica de cortes", mas sim um lugar onde meus amigos pudessem se sentir bem.</p><p>Hoje, a barbearia cresceu, mas a essência é a mesma: <strong>respeito pelo cliente e paixão pela tesoura.</strong></p><p>Aqui você não é um número. Você senta, toma uma cerveja, troca uma ideia e sai renovado.</p></div>
                </div>
            </div>
        </div>
    </section>

    <!-- TESTIMONIALS -->
    <section class="py-24">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16"><h2 class="text-3xl md:text-4xl font-bold text-white font-display mb-4">Quem passa por aqui</h2><p class="text-zinc-500">A opinião da galera que confia no nosso trabalho.</p></div>
            <div id="testimonials-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
        </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="pt-20 pb-10 border-t border-white/5 bg-[#0e0e10]">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-16 mb-20">
                <div class="space-y-6"><h2 class="text-2xl font-bold text-white font-display">RICARDO</h2><p class="text-zinc-400 font-light leading-relaxed">Cortes clássicos, barba feita na toalha quente e aquele ambiente que você respeita.</p></div>
                <div class="space-y-6"><h3 class="text-white font-bold uppercase text-sm tracking-wider">Contato</h3><ul class="space-y-4"><li class="flex gap-4 text-zinc-400"><i data-lucide="map-pin" class="w-5 h-5 text-amber-600 shrink-0"></i><span class="text-sm">Rua das Pedras, 123 - Centro<br>Florianópolis, SC</span></li><li class="flex gap-4 text-zinc-400"><i data-lucide="phone" class="w-5 h-5 text-amber-600 shrink-0"></i><span class="text-sm">(48) 99999-9999</span></li></ul></div>
                <div class="space-y-6"><h3 class="text-white font-bold uppercase text-sm tracking-wider">Funcionamento</h3><ul class="space-y-2 text-zinc-400 text-sm"><li class="flex justify-between border-b border-white/5 pb-2"><span>Seg - Sex</span><span class="text-white">09:00 - 20:00</span></li><li class="flex justify-between border-b border-white/5 pb-2"><span>Sábado</span><span class="text-white">09:00 - 18:00</span></li></ul></div>
            </div>
            <div class="border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center text-zinc-600 text-xs gap-4"><p>&copy; 2024 Ricardo Barbershop.</p></div>
        </div>
    </section>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="closeAuthModal()"></div>
        <div class="w-full max-w-md bg-[#18181b] border border-white/10 rounded-2xl shadow-2xl relative z-10">
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-zinc-500 hover:text-white p-2"><i data-lucide="x" class="w-5 h-5"></i></button>
            <div class="p-8">
                <div id="auth-message" class="hidden mb-6 p-3 rounded bg-amber-900/30 border border-amber-900 text-xs text-amber-200">Faça login para continuar.</div>
                <h3 class="text-2xl font-display font-bold text-white mb-6 text-center">Acesse sua conta</h3>
                <button onclick="handleGoogleLogin()" class="w-full bg-white hover:bg-zinc-200 text-black font-bold py-3.5 rounded-lg flex items-center justify-center gap-3 mb-6 transition-all"><svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>Entrar com Google</button>
                <div class="relative my-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-white/10"></div></div><div class="relative flex justify-center text-[10px] uppercase"><span class="bg-[#18181b] px-4 text-zinc-600">Ou use e-mail</span></div></div>
                <div class="space-y-4">
                    <input type="email" id="login-email" class="w-full glass-input rounded-lg py-3 px-4 text-sm" placeholder="seu@email.com">
                    <input type="password" id="login-password" class="w-full glass-input rounded-lg py-3 px-4 text-sm" placeholder="Senha">
                    <button onclick="handleLogin()" class="w-full bg-zinc-800 hover:bg-zinc-700 text-white font-medium py-3 rounded-lg">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- BOOKING MODAL -->
    <div id="booking-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-0 md:p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="closeBooking()"></div>
        <div class="w-full h-full md:h-[85vh] md:max-w-5xl md:rounded-2xl bg-[#18181b] border border-white/10 shadow-2xl relative z-10 flex flex-col">
            <div class="p-5 border-b border-white/5 flex justify-between items-center bg-zinc-900/50">
                <div><h3 class="text-xl font-display font-bold text-white">Agendar</h3><span class="text-[10px] text-amber-500 font-bold uppercase tracking-widest" id="step-indicator">Passo 1</span></div>
                <button onclick="closeBooking()" class="text-zinc-400 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <div class="flex flex-1 overflow-hidden flex-col md:flex-row">
                <div id="booking-content" class="flex-1 p-6 md:p-10 overflow-y-auto custom-scrollbar md:border-r border-white/5 pb-32"></div>
                <div class="hidden md:flex w-80 bg-zinc-900/30 flex-col p-8 border-l border-white/5">
                    <h4 class="text-xs font-bold text-zinc-500 uppercase tracking-widest mb-6">Resumo</h4>
                    <div class="space-y-4 flex-1 text-sm text-zinc-400">
                        <div class="flex justify-between"><span class="font-bold">Serviço</span><span id="summ-serv" class="text-white">--</span></div>
                        <div class="flex justify-between"><span class="font-bold">Profissional</span><span id="summ-prof" class="text-white">--</span></div>
                        <div class="flex justify-between"><span class="font-bold">Data</span><span id="summ-date" class="text-white">--</span></div>
                        <div class="flex justify-between"><span class="font-bold">Pagamento</span><span class="text-white">No Local</span></div>
                    </div>
                    <div class="pt-6 border-t border-white/10"><div class="flex justify-between items-end mb-4"><span class="text-zinc-500 text-xs font-bold uppercase">Total</span><span id="summ-total" class="text-2xl font-bold text-white">R$ 0</span></div><div id="desktop-actions"></div></div>
                </div>
            </div>
            <div id="mobile-actions" class="md:hidden p-4 border-t border-white/5 bg-[#18181b] flex justify-between items-center absolute bottom-0 w-full z-20"></div>
        </div>
    </div>

    <!-- APPOINTMENTS MODAL -->
    <div id="appointments-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="closeAppointments()"></div>
        <div class="w-full max-w-lg bg-[#18181b] border border-white/10 rounded-2xl shadow-2xl relative z-10 flex flex-col max-h-[80vh]">
            <div class="p-6 border-b border-white/5 flex justify-between items-center"><h3 class="text-lg font-bold text-white">Meus Horários</h3><button onclick="closeAppointments()"><i data-lucide="x" class="text-white"></i></button></div>
            <div id="appointments-content" class="p-6 overflow-y-auto flex-1 custom-scrollbar"></div>
        </div>
    </div>

    <script>
        // CONFIG
        const SUPABASE_URL = 'https://mfycmbbsijylwervuuwf.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1meWNtYmJzaWp5bHdlcnZ1dXdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3Mzk0NTYsImV4cCI6MjA4NTMxNTQ1Nn0.cJ5gn5a2MKzux6Aigvno9hjOIcPEbnuBwukAuOPzRLs';
        
        let supabaseClient;
        let USE_MOCK = false;

        // DATA
        const SERVICES = [
            { id: 1, category: 'cabelo', name: "Corte Clássico", price: 50, duration: "45 min", description: "O tradicional na tesoura ou máquina." },
            { id: 2, category: 'barba', name: "Ritual de Barba", price: 40, duration: "30 min", description: "Toalha quente e alinhamento." },
            { id: 3, category: 'combo', name: "Cabelo & Barba", price: 80, duration: "75 min", description: "A experiência completa." },
            { id: 4, category: 'cabelo', name: "Acabamento", price: 20, duration: "15 min", description: "Pezinho e contorno." },
            { id: 5, category: 'cabelo', name: "Infantil", price: 45, duration: "40 min", description: "Para crianças." },
            { id: 6, category: 'cabelo', name: "Selagem", price: 120, duration: "90 min", description: "Redução de volume." }
        ];

        const BARBERS = [
            { id: 1, name: "Ricardo", role: "Master" }, { id: 2, name: "André", role: "Pro" }, { id: 3, name: "Disponível", role: "Equipe" }
        ];

        const TESTIMONIALS = [
            { id: 1, name: "Carlos E.", text: "O melhor degradê que já fiz.", rating: 5 },
            { id: 2, name: "Felipe S.", text: "Ambiente top e cerveja gelada.", rating: 5 },
            { id: 3, name: "João P.", text: "Agendamento muito prático.", rating: 5 },
        ];

        // STATE
        let currentUser = null;
        let currentStep = 1;
        let selectedCategory = 'todos';
        let pendingBooking = false; 
        let bookingData = { service: null, barber: null, date: null, time: null, clientName: '', clientPhone: '' };
        let appointments = [];
        let unavailableSlots = []; 

        // GLOBAL FUNCTIONS
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); lucide.createIcons(); }
        function toggleProfileDropdown() { document.getElementById('profile-dropdown').classList.toggle('hidden'); }
        function openAuthModal(t) { document.getElementById('auth-modal').classList.remove('hidden'); if(t) switchAuthTab(t); }
        function closeAuthModal() { document.getElementById('auth-modal').classList.add('hidden'); pendingBooking=false; document.getElementById('auth-message').classList.add('hidden'); }
        function switchAuthTab(t) {
            document.getElementById('form-login').classList.toggle('hidden', t!=='login');
            document.getElementById('form-register').classList.toggle('hidden', t!=='register');
            document.getElementById('tab-login').className = t==='login' ? 'flex-1 pb-3 text-amber-500 border-b-2 border-amber-500 font-bold text-sm' : 'flex-1 pb-3 text-zinc-500 font-medium text-sm';
            document.getElementById('tab-register').className = t==='register' ? 'flex-1 pb-3 text-amber-500 border-b-2 border-amber-500 font-bold text-sm' : 'flex-1 pb-3 text-zinc-500 font-medium text-sm';
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            if(!email) return alert("Digite um email");
            if(USE_MOCK) {
                const s = { user: { id: 'mock1', email, user_metadata: { full_name: email.split('@')[0] } } };
                localStorage.setItem('mock_session', JSON.stringify(s));
                handleSession(s);
            } else {
                const { error } = await supabaseClient.auth.signInWithPassword({ email, password: document.getElementById('login-password').value });
                if(error) alert(error.message);
            }
        }
        async function handleGoogleLogin() {
            if(USE_MOCK) {
                const s = { user: { id: 'mock2', email:'demo@gmail.com', user_metadata: { full_name: 'Usuário Demo' } } };
                localStorage.setItem('mock_session', JSON.stringify(s));
                handleSession(s);
            } else {
                await supabaseClient.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.href } });
            }
        }
        async function logout() {
            if(USE_MOCK) localStorage.removeItem('mock_session');
            else await supabaseClient.auth.signOut();
            handleSession(null);
        }

        function startBooking() {
            if(!currentUser) { openAuthModal('login'); document.getElementById('auth-message').classList.remove('hidden'); pendingBooking=true; return; }
            bookingData = { service: null, barber: null, date: null, time: null, clientName: currentUser.name, clientPhone: '' };
            currentStep = 1;
            document.getElementById('booking-modal').classList.remove('hidden');
            renderStep();
        }
        function closeBooking() { document.getElementById('booking-modal').classList.add('hidden'); }
        function openAppointments() {
            if(!currentUser) return openAuthModal('login');
            document.getElementById('appointments-modal').classList.remove('hidden');
            loadAppointments();
        }
        function closeAppointments() { document.getElementById('appointments-modal').classList.add('hidden'); }

        // LOGIC
        function handleSession(session) {
            currentUser = session ? { id: session.user.id, name: session.user.user_metadata.full_name || 'Usuário', email: session.user.email } : null;
            const userEls = document.querySelectorAll('#nav-user, #mobile-user');
            const guestEls = document.querySelectorAll('#nav-guest, #mobile-guest');
            userEls.forEach(e => e.classList.toggle('hidden', !currentUser));
            guestEls.forEach(e => e.classList.toggle('hidden', !!currentUser));
            if(currentUser) {
                document.getElementById('user-name-display').textContent = currentUser.name;
                document.getElementById('mobile-user-name').textContent = currentUser.name;
                document.getElementById('user-initial').textContent = currentUser.name.charAt(0);
                closeAuthModal();
                if(pendingBooking) { pendingBooking=false; startBooking(); }
                loadAppointments();
            }
        }

        async function loadAppointments() {
            const list = document.getElementById('appointments-content');
            list.innerHTML = '<div class="flex justify-center py-8"><div class="loader"></div></div>';
            if(USE_MOCK) {
                appointments = JSON.parse(localStorage.getItem('my_apps') || '[]');
            } else {
                const { data } = await supabaseClient.from('appointments').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
                appointments = data || [];
            }
            renderAppointmentsList();
        }

        function renderAppointmentsList() {
            const list = document.getElementById('appointments-content');
            if(appointments.length === 0) {
                list.innerHTML = `<div class="text-center py-10 text-zinc-500"><i data-lucide="calendar-x" class="w-12 h-12 mx-auto mb-4 opacity-50"></i><p>Nada agendado.</p></div>`;
            } else {
                list.innerHTML = `<div class="space-y-3">` + appointments.map(a => `
                    <div class="glass-card p-4 rounded-xl border border-white/5 flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-white">${a.service?.name || a.details?.service?.name || 'Corte'}</h4>
                            <p class="text-xs text-zinc-400">${new Date(a.date_iso || a.dateStr).toLocaleDateString()} às ${a.time || a.details?.time}</p>
                            <p class="text-[10px] text-amber-500 font-bold uppercase mt-1">Confirmado</p>
                        </div>
                        <button onclick="deleteAppointment('${a.id}')" class="text-red-400 hover:bg-red-500/10 p-2 rounded"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>`).join('') + `</div>`;
            }
            lucide.createIcons();
        }

        async function deleteAppointment(id) {
            if(!confirm("Cancelar?")) return;
            if(USE_MOCK) {
                appointments = appointments.filter(a => a.id != id);
                localStorage.setItem('my_apps', JSON.stringify(appointments));
            } else {
                await supabaseClient.from('appointments').delete().eq('id', id);
            }
            loadAppointments();
        }

        // STEP RENDER
        function selectCategory(c) { selectedCategory = c; renderStep(); }
        function selectService(id) { 
            const s = SERVICES.find(x => x.id === id);
            if(s) { bookingData.service = s; currentStep = 2; renderStep(); }
        }
        function selectBarber(id) { bookingData.barber = BARBERS.find(b => b.id === id); currentStep = 3; renderStep(); }
        function selectDate(iso) { 
            bookingData.date = new Date(iso); bookingData.time = null; renderStep(); 
            // Mock unavailable slots logic
            unavailableSlots = [];
        }
        function selectTime(t) { bookingData.time = t; currentStep = 4; renderStep(); }
        function updatePhone(v) { 
            v = v.replace(/\D/g,'').replace(/(\d{2})(\d{5})(\d{4})/,'($1) $2-$3').slice(0,15);
            bookingData.clientPhone = v;
            document.getElementById('phone-input').value = v;
            renderActions();
        }

        async function confirmBooking() {
            if(USE_MOCK) {
                const app = { id: Date.now(), ...bookingData, dateStr: bookingData.date.toISOString() };
                const apps = JSON.parse(localStorage.getItem('my_apps') || '[]');
                apps.push(app);
                localStorage.setItem('my_apps', JSON.stringify(apps));
            } else {
                await supabaseClient.from('appointments').insert({ user_id: currentUser.id, details: bookingData, date_iso: bookingData.date.toISOString() });
            }
            loadAppointments();
            currentStep = 5;
            renderStep();
        }

        function renderStep() {
            const c = document.getElementById('booking-content');
            document.getElementById('step-indicator').textContent = `Passo ${currentStep}/5`;
            updateSummary();
            
            let h = '<div class="animate-fade-in-up pb-24 md:pb-0">';
            if(currentStep === 1) {
                h += `<h3 class="text-2xl font-bold text-white mb-6">Escolha o Serviço</h3><div class="flex gap-2 mb-6 overflow-x-auto pb-2 custom-scrollbar">
                <button onclick="selectCategory('todos')" class="${selectedCategory==='todos'?'bg-zinc-100 text-black':'bg-zinc-800 text-zinc-400'} px-4 py-2 rounded-full text-xs font-bold uppercase">Todos</button>
                <button onclick="selectCategory('cabelo')" class="${selectedCategory==='cabelo'?'bg-zinc-100 text-black':'bg-zinc-800 text-zinc-400'} px-4 py-2 rounded-full text-xs font-bold uppercase">Cabelo</button>
                <button onclick="selectCategory('barba')" class="${selectedCategory==='barba'?'bg-zinc-100 text-black':'bg-zinc-800 text-zinc-400'} px-4 py-2 rounded-full text-xs font-bold uppercase">Barba</button></div>
                <div class="grid grid-cols-1 gap-3">` + SERVICES.filter(s => selectedCategory === 'todos' || s.category === selectedCategory).map(s => `
                    <div onclick="selectService(${s.id})" class="glass-card p-4 rounded-xl border border-white/5 bg-zinc-800/30 cursor-pointer flex justify-between items-center hover:bg-zinc-800/50 ${bookingData.service?.id===s.id?'border-amber-500':''}">
                        <div><h4 class="font-bold text-white">${s.name}</h4><span class="text-xs text-zinc-500">${s.duration}</span></div>
                        <span class="font-bold text-amber-500">R$ ${s.price}</span>
                    </div>`).join('') + `</div>`;
            } else if(currentStep === 2) {
                h += `<h3 class="text-2xl font-bold text-white mb-6">Profissional</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4">` + BARBERS.map(b => `
                    <div onclick="selectBarber(${b.id})" class="glass-card p-4 rounded-xl border border-white/5 bg-zinc-800/30 cursor-pointer flex items-center gap-4 hover:bg-zinc-800/50">
                        <div class="w-10 h-10 rounded-full bg-zinc-700 flex items-center justify-center text-zinc-400"><i data-lucide="user"></i></div>
                        <div><h4 class="font-bold text-white">${b.name}</h4><p class="text-xs text-amber-500 uppercase">${b.role}</p></div>
                    </div>`).join('') + `</div>`;
            } else if(currentStep === 3) {
                const dates = []; for(let i=0;i<7;i++){ const d=new Date(); d.setDate(d.getDate()+i); dates.push(d); }
                h += `<h3 class="text-2xl font-bold text-white mb-6">Data e Hora</h3><div class="flex gap-3 overflow-x-auto pb-4 mb-6 custom-scrollbar">` + dates.map(d => `
                    <div onclick="selectDate('${d.toISOString()}')" class="flex-shrink-0 w-20 h-24 rounded-xl border ${bookingData.date?.toDateString()===d.toDateString()?'bg-amber-600 border-amber-500 text-white':'bg-zinc-800/30 border-white/5 text-zinc-400'} flex flex-col items-center justify-center cursor-pointer transition-all">
                        <span class="text-[0.6rem] uppercase font-bold tracking-wider mb-1">${d.toLocaleDateString('pt-BR',{weekday:'short'}).replace('.','')}</span><span class="text-2xl font-bold font-display">${d.getDate()}</span>
                    </div>`).join('') + `</div>`;
                if(bookingData.date) {
                    const times = ['09:00','10:00','11:00','13:00','14:00','15:00','16:00','17:00','18:00','19:00'];
                    h += `<div class="grid grid-cols-4 gap-3 animate-fade-in-up">` + times.map(t => `<button onclick="selectTime('${t}')" class="py-2 rounded-lg text-sm font-bold border ${bookingData.time===t?'bg-white text-black border-white':'bg-zinc-800/30 border-white/5 text-zinc-300 hover:border-amber-500'}">${t}</button>`).join('') + `</div>`;
                }
            } else if(currentStep === 4) {
                h += `<h3 class="text-2xl font-bold text-white mb-6">Finalizar</h3><div class="space-y-4 max-w-md">
                    <div><label class="text-xs font-bold text-zinc-500 uppercase">Nome</label><input type="text" value="${bookingData.clientName}" readonly class="w-full glass-input rounded-lg py-3 px-4 text-zinc-400 cursor-not-allowed"></div>
                    <div><label class="text-xs font-bold text-zinc-500 uppercase">WhatsApp</label><input id="phone-input" type="tel" oninput="updatePhone(this.value)" value="${bookingData.clientPhone}" class="w-full glass-input rounded-lg py-3 px-4 text-white" placeholder="(00) 00000-0000" maxlength="15"></div>
                    <div class="p-4 rounded-xl bg-zinc-800/50 border border-white/5 flex items-center gap-3"><i data-lucide="store" class="text-amber-500"></i><div><p class="text-sm font-bold text-white">Pagamento no Local</p></div></div>
                </div>`;
            } else if(currentStep === 5) {
                h += `<div class="flex flex-col items-center justify-center text-center h-full"><div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6"><i data-lucide="check" class="w-10 h-10 text-green-500"></i></div><h3 class="text-3xl font-display font-bold text-white mb-2">Confirmado!</h3><p class="text-zinc-400 mb-8">Te esperamos lá.</p><button onclick="closeBooking(); openAppointments()" class="btn-primary py-3 px-8 rounded-xl font-bold w-full max-w-xs">Ver Agendamentos</button></div>`;
            }
            c.innerHTML = h + '</div>';
            renderActions();
            lucide.createIcons();
        }

        function renderActions() {
            const d = document.getElementById('desktop-actions');
            const m = document.getElementById('mobile-actions');
            let b = '';
            if(currentStep > 1 && currentStep < 5) b += `<button onclick="currentStep--; renderStep()" class="text-zinc-400 font-bold text-sm mr-4">Voltar</button>`;
            if(currentStep === 4) b += `<button onclick="confirmBooking()" class="bg-amber-600 text-white font-bold py-3 px-6 rounded-lg ${bookingData.clientPhone.length<14?'opacity-50 cursor-not-allowed':''}" ${bookingData.clientPhone.length<14?'disabled':''}>Confirmar</button>`;
            
            if(d) d.innerHTML = currentStep < 5 ? b : '';
            if(m) m.innerHTML = currentStep < 5 ? b : '';
        }

        function updateSummary() {
            document.getElementById('summ-serv').textContent = bookingData.service?.name || '--';
            document.getElementById('summ-prof').textContent = bookingData.barber?.name || '--';
            document.getElementById('summ-date').textContent = bookingData.date ? `${bookingData.date.toLocaleDateString()} ${bookingData.time||''}` : '--';
            const t = bookingData.service ? `R$ ${bookingData.service.price}` : 'R$ 0';
            document.getElementById('summ-total').textContent = t;
            document.getElementById('mobile-total').textContent = t;
        }

        // MAIN INIT
        try {
            if (SUPABASE_URL.startsWith('SUA_')) throw new Error();
            const { createClient } = supabase;
            supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            supabaseClient.auth.getSession().then(({data}) => handleSession(data.session));
            supabaseClient.auth.onAuthStateChange((_e, session) => handleSession(session));
        } catch {
            console.log("Mock Mode");
            USE_MOCK = true;
            const s = localStorage.getItem('mock_session');
            if(s) handleSession(JSON.parse(s)); else updateUI(null);
        }

        // STATIC RENDER
        document.getElementById('services-grid').innerHTML = SERVICES.map(s => `
            <div class="glass-card p-5 rounded-xl border border-white/5 bg-zinc-800/20">
                <div class="flex justify-between items-start mb-2"><h3 class="font-display font-bold text-lg text-white">${s.name}</h3><span class="text-amber-500 font-bold">R$ ${s.price}</span></div>
                <p class="text-sm text-zinc-400 mb-4">${s.description}</p>
                <button onclick="selectService(${s.id}); startBooking()" class="text-xs font-bold uppercase tracking-widest text-zinc-300 hover:text-white border-b border-white/10 pb-0.5">Reservar</button>
            </div>`).join('');
            
        document.getElementById('testimonials-grid').innerHTML = TESTIMONIALS.map(t => `<div class="glass-card p-8 rounded-2xl border border-white/5 relative bg-zinc-900/20"><div class="absolute -top-3 left-8 bg-amber-600 text-white px-3 py-1 rounded-md shadow-lg shadow-amber-900/50 flex gap-1 text-xs">${Array(t.rating).fill('<i data-lucide="star" class="w-3 h-3 fill-current"></i>').join('')}</div><div class="mt-4 mb-6"><p class="text-zinc-300 italic text-lg leading-relaxed">"${t.text}"</p></div><div class="flex items-center gap-4"><div class="w-10 h-10 rounded-full bg-gradient-to-br from-zinc-700 to-zinc-900 flex items-center justify-center border border-white/10"><span class="font-bold text-zinc-400 text-sm">${t.name.charAt(0)}</span></div><div><span class="font-bold text-white block text-sm">${t.name}</span><span class="text-xs text-zinc-500 uppercase tracking-wider">Cliente Verificado</span></div></div></div>`).join('');
    </script>
</body>
</html>
